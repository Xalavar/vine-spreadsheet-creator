{"version":3,"file":"data-management.js","names":["pdfjsLib","_interopRequireWildcard","require","_document$getElementB","_document$getElementB2","_getRequireWildcardCache","e","WeakMap","r","t","__esModule","default","has","get","n","__proto__","a","Object","defineProperty","getOwnPropertyDescriptor","u","hasOwnProperty","call","i","set","document","getElementById","addEventListener","files","length","disabled","classList","remove","add","file","extractTextFromPDF","then","text","extractedText","filter","obj","console","log","catch","error","OldItemPositions","Promise","resolve","reject","reader","FileReader","onload","event","buffer","target","result","getDocument","promise","pdf","numPages","promises","push","getPage","page","getTextContent","all","textContents","forEach","content","textObject","previousXTranslation","counter","items","item","index","array","horizontalTranslation","transform","formalName","toString","str","readAsArrayBuffer"],"sources":["../src/data-management.js"],"sourcesContent":["/* -- PDF Import related stuff -- */\r\nimport * as pdfjsLib from \"pdfjs-dist\";\r\n\r\ndocument.getElementById('pdf-import')?.addEventListener('change', function() {\r\n    (this.files && this.files.length > 0) ? document.getElementById('pdf-import-button').disabled = false : document.getElementById('pdf-import-button').disabled = true;\r\n    (this.files && this.files.length > 0) ? document.getElementById('pdf-import-button').classList.remove('disabled') : document.getElementById('pdf-import-button').classList.add('disabled');\r\n});\r\n\r\ndocument.getElementById('pdf-import-button')?.addEventListener('click', function() {\r\n    const file = document.getElementById('pdf-import').files[0];\r\n    extractTextFromPDF(file).then(function(text) {\r\n        // Assuming extractedText is the array containing objects, remove header objects\r\n        var extractedText = text.filter(obj => obj['asin'] !== 'ASIN');\r\n        console.log('Extracted text:', extractedText);\r\n\r\n        // -- Now save the data to the IndexedDB --\r\n\r\n\r\n    }).catch(function(error) {\r\n        console.error('Error extracting text:', error);\r\n    });\r\n});\r\n\r\n// All horizontal translations of parseable data\r\n// For Itemized Reports generated for 2023 and earlier\r\nconst OldItemPositions = {\r\n    '38': 'asin',\r\n    '126.91': 'name',\r\n    '372.72': 'orderDate',\r\n    '445.94': 'titleTransferDate',\r\n    '519.16': 'etv'\r\n}\r\n\r\n// All horizontal translations of parseable data\r\n// For Itemized Reports generated for 2024 and later\r\n/*\r\nconst NewItemPositions = {\r\n    '38': 'orderID',\r\n    '38': 'asin',\r\n    '126.91': 'name',\r\n    '126.91': 'orderStatus',\r\n    '372.72': 'orderDate',\r\n    '445.94': 'dateShipped',\r\n    '445.94': 'dateShipped',\r\n    '519.16': 'etv'\r\n}*/\r\n\r\nfunction extractTextFromPDF(file) {\r\n    return new Promise((resolve, reject) => {\r\n        // Create a new FileReader object\r\n        const reader = new FileReader();\r\n\r\n        // Set up FileReader onload event\r\n        reader.onload = function(event) {\r\n            // Get the ArrayBuffer of the uploaded file\r\n            const buffer = event.target.result;\r\n\r\n            // Load the PDF using PDF.js\r\n            pdfjsLib.getDocument(buffer).promise.then(function(pdf) {\r\n                // Initialize array to store extracted text objects\r\n                const extractedText = [];\r\n\r\n                // Iterate through each page of the PDF\r\n                const numPages = pdf.numPages;\r\n                const promises = [];\r\n                for (let i = 1; i <= numPages; i++) {\r\n                    // Retrieve text content of each page\r\n                    promises.push(pdf.getPage(i).then(function(page) {\r\n                        return page.getTextContent();\r\n                    }));\r\n                }\r\n\r\n                // Resolve all promises once text content of all pages is retrieved\r\n                Promise.all(promises).then(function(textContents) {\r\n\r\n                    textContents.forEach(function(content) {\r\n                        // Initialize object to store extracted text for this page\r\n                        var textObject = {};\r\n                        var previousXTranslation;\r\n                        var counter = 0;\r\n\r\n                        // Process each item in the content\r\n                        content.items.forEach(function(item, index, array) {\r\n                            const horizontalTranslation = item.transform[4];\r\n                            const formalName = OldItemPositions[horizontalTranslation.toString()];\r\n\r\n                            if (counter > 3 && horizontalTranslation == 38) {\r\n                                // begin creating a new object to export\r\n                                counter = 0;\r\n                                // Add text object for this page to the extractedText array\r\n                                extractedText.push(textObject);\r\n                                textObject = {};\r\n                            }\r\n\r\n                            if (formalName) {\r\n\r\n                                // Check if the current formal name matches the previous one\r\n                                if (previousXTranslation === horizontalTranslation) {\r\n                                    // Append the string to the last string that was added\r\n                                    textObject[formalName] += ' ' + item.str;\r\n                                } else {\r\n                                    // Add string to the corresponding key in the text object\r\n                                    textObject[formalName] = item.str;\r\n                                }\r\n                                previousXTranslation = horizontalTranslation;\r\n                            }\r\n\r\n                            counter++;\r\n\r\n                        });\r\n                        // Export the last object to the array\r\n                        extractedText.push(textObject);\r\n\r\n                    });\r\n\r\n\r\n                    // Resolve with the extracted text object\r\n                    resolve(extractedText);\r\n                }).catch(function(error) {\r\n                    reject(error);\r\n                });\r\n            }).catch(function(error) {\r\n                reject(error);\r\n            });\r\n        };\r\n\r\n        // Read the uploaded file as ArrayBuffer\r\n        reader.readAsArrayBuffer(file);\r\n    });\r\n}\r\n\r\n\r\n"],"mappings":"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","ignoreList":[]}